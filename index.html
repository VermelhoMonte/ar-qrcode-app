<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR 3D Model App</title>
</head>

<body>
    <h1>3D Model Viewer</h1>
    <video id="camera" autoplay playsinline></video>
    <canvas id="qrCanvas"></canvas>
    <div id="status">Initializing...</div> <!-- Status Div -->

    <!-- Load jsQR using a regular script tag (still included for future use if needed) -->
    <script src="./libs/jsqr/dist/jsQR.js"></script>

    <!-- Load Three.js and GLTFLoader using ES modules -->
    <script type="module">
        import * as THREE from './libs/three/build/three.module.js';
        import { GLTFLoader } from './libs/three/examples/jsm/loaders/GLTFLoader.js';

        const statusElement = document.getElementById('status');

        function updateStatus(message) {
            console.log(message);
            statusElement.textContent = message; // Updates the status in the HTML
        }

        // Initialize and load the 3D model when the app starts
        window.addEventListener('load', () => {
            load3DModel();
        });

        function load3DModel() {
            updateStatus("Initializing 3D scene...");

            // Create a Three.js scene
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // Create the renderer and append it to the DOM
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            updateStatus("3D scene initialized. Loading model...");

            // Load the GLTF model
            const loader = new GLTFLoader();
            loader.load(
                'model/model.gltf',
                (gltf) => {
                    scene.add(gltf.scene);
                    updateStatus("Model loaded successfully.");
                },
                (xhr) => {
                    const progress = (xhr.loaded / xhr.total) * 100;
                    updateStatus(`Model loading... ${Math.round(progress)}% complete.`);
                },
                (error) => {
                    updateStatus("Error loading model.");
                    console.error('An error happened', error);
                }
            );

            // Animate the scene
            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }
            animate();

            updateStatus("Rendering scene...");
        }
    </script>
</body>

</html>